
import streamlit as st
import requests

encoding_maps = {'age_ben_snds': {'0': 0, '20': 1, '30': 2, '40': 3, '50': 4, '60': 5, '70': 6, '80': 7}, 'asu_nat': {'10': 0, '22': 1, '30': 2, '40': 3, '70': 4, '80': 5, '90': 6}, 'ben_qlt_cod': {'1': 0, '2': 1, '3': 2, '4': 3}, 'ben_sex_cod': {'1': 0, '2': 1}, 'ben_res_reg': {'5': 0, '11': 1, '24': 2, '27': 3, '28': 4, '32': 5, '44': 6, '52': 7, '53': 8, '75': 9, '76': 10, '84': 11, '93': 12}, 'prs_nat': {'1039': 0, '1040': 1, '1041': 2, '1042': 3, '1043': 4, '1046': 5, '1047': 6, '1048': 7, '1049': 8, '1050': 9, '1051': 10, '1054': 11, '1055': 12, '1056': 13, '1058': 14, '1059': 15, '1060': 16, '1061': 17, '1064': 18, '1066': 19, '1067': 20, '1068': 21, '1069': 22, '1070': 23, '1071': 24, '1072': 25, '1073': 26, '1074': 27, '1075': 28, '1076': 29, '1077': 30, '1078': 31, '1079': 32, '1080': 33, '1081': 34, '1082': 35, '1083': 36, '1084': 37, '1085': 38, '1086': 39, '1088': 40, '1090': 41, '1091': 42, '1092': 43, '1093': 44, '1094': 45, '1098': 46, '1099': 47, '1100': 48, '1101': 49, '1102': 50, '1103': 51, '1104': 52, '1105': 53, '1106': 54, '1107': 55, '1108': 56, '1109': 57, '1110': 58, '1111': 59, '1112': 60, '1113': 61, '1114': 62, '1116': 63, '1117': 64, '1118': 65, '1119': 66, '1121': 67, '1122': 68, '1125': 69, '1126': 70, '1127': 71, '1132': 72, '1134': 73, '1135': 74, '1140': 75, '1148': 76, '1149': 77, '1153': 78, '1154': 79, '1159': 80, '1168': 81, '1169': 82, '1172': 83, '1174': 84, '1175': 85, '1177': 86, '1179': 87, '1182': 88, '1191': 89, '1192': 90, '1193': 91, '1194': 92, '1195': 93, '1196': 94, '1199': 95, '1201': 96, '1202': 97, '1203': 98, '1209': 99, '1210': 100, '1211': 101, '1212': 102, '1213': 103, '1214': 104, '1215': 105, '1216': 106, '1218': 107, '1224': 108, '1226': 109, '1227': 110, '1228': 111, '1312': 112, '1318': 113, '1321': 114, '1322': 115, '1323': 116, '1324': 117, '1325': 118, '1331': 119, '1351': 120, '1352': 121, '1353': 122, '1354': 123, '1361': 124, '1400': 125, '1401': 126, '1402': 127, '1404': 128, '1405': 129, '1406': 130, '1407': 131, '1408': 132, '1409': 133, '1410': 134, '1412': 135, '1413': 136, '1414': 137, '1415': 138, '1416': 139, '1417': 140, '1418': 141, '1419': 142, '1420': 143, '1422': 144, '1424': 145, '1425': 146, '1434': 147, '1435': 148, '1436': 149, '1437': 150, '1439': 151, '1451': 152, '1453': 153, '1454': 154, '1455': 155, '1456': 156, '1460': 157, '1462': 158, '1465': 159, '1467': 160, '1470': 161, '1471': 162, '1472': 163, '1473': 164, '1475': 165, '1476': 166, '1477': 167, '1521': 168, '1522': 169, '1523': 170, '1640': 171, '1650': 172, '1652': 173, '1811': 174, '1812': 175, '1813': 176, '1821': 177, '1841': 178, '1842': 179, '1843': 180, '1844': 181, '1845': 182, '1846': 183, '1847': 184, '1848': 185, '1849': 186, '1901': 187, '1903': 188, '1904': 189, '1905': 190, '1906': 191, '1907': 192, '1911': 193, '1912': 194, '1913': 195, '1918': 196, '1920': 197, '1923': 198, '1927': 199, '1929': 200, '1930': 201, '1933': 202, '1934': 203, '1935': 204, '1936': 205, '1937': 206, '1938': 207, '1939': 208, '1940': 209, '1941': 210, '1942': 211, '1943': 212, '1944': 213, '1945': 214, '1946': 215, '1947': 216, '1948': 217, '1949': 218, '1951': 219, '1952': 220, '1954': 221, '1956': 222, '1957': 223, '1965': 224, '1971': 225, '1972': 226, '1973': 227, '1974': 228, '1975': 229, '1976': 230, '1981': 231, '1982': 232, '1983': 233, '1991': 234, '1992': 235, '1993': 236, '1994': 237, '1995': 238, '1997': 239, '1999': 240, '2104': 241, '2105': 242, '2106': 243, '2107': 244, '2108': 245, '2109': 246, '2110': 247, '2111': 248, '2112': 249, '2113': 250, '2116': 251, '2117': 252, '2120': 253, '2132': 254, '2133': 255, '2134': 256, '2135': 257, '2136': 258, '2137': 259, '2138': 260, '2141': 261, '2143': 262, '2144': 263, '2147': 264, '2148': 265, '2150': 266, '2151': 267, '2152': 268, '2153': 269, '2155': 270, '2156': 271, '2157': 272, '2158': 273, '2159': 274, '2160': 275, '2161': 276, '2164': 277, '2167': 278, '2168': 279, '2169': 280, '2176': 281, '2179': 282, '2192': 283, '2193': 284, '2195': 285, '2198': 286, '2200': 287, '2211': 288, '2212': 289, '2213': 290, '2221': 291, '2222': 292, '2230': 293, '2231': 294, '2234': 295, '2237': 296, '2238': 297, '2239': 298, '2240': 299, '2250': 300, '2251': 301, '2252': 302, '2253': 303, '2258': 304, '2263': 305, '2264': 306, '2265': 307, '2269': 308, '2280': 309, '2281': 310, '2283': 311, '2284': 312, '2285': 313, '2286': 314, '2287': 315, '2288': 316, '2290': 317, '2297': 318, '2298': 319, '2299': 320, '2300': 321, '2302': 322, '2303': 323, '2304': 324, '2309': 325, '2331': 326, '2332': 327, '2336': 328, '2337': 329, '2338': 330, '2339': 331, '2342': 332, '2343': 333, '2344': 334, '2345': 335, '2346': 336, '2347': 337, '2351': 338, '2352': 339, '2354': 340, '2391': 341, '2392': 342, '2411': 343, '2414': 344, '2415': 345, '2416': 346, '2418': 347, '2419': 348, '2420': 349, '2422': 350, '2426': 351, '2428': 352, '3101': 353, '3102': 354, '3103': 355, '3104': 356, '3105': 357, '3106': 358, '3107': 359, '3108': 360, '3109': 361, '3110': 362, '3111': 363, '3112': 364, '3113': 365, '3115': 366, '3116': 367, '3117': 368, '3118': 369, '3120': 370, '3121': 371, '3122': 372, '3123': 373, '3124': 374, '3125': 375, '3128': 376, '3129': 377, '3130': 378, '3131': 379, '3132': 380, '3133': 381, '3134': 382, '3136': 383, '3138': 384, '3139': 385, '3140': 386, '3142': 387, '3143': 388, '3144': 389, '3145': 390, '3146': 391, '3147': 392, '3148': 393, '3149': 394, '3151': 395, '3152': 396, '3153': 397, '3154': 398, '3155': 399, '3156': 400, '3157': 401, '3158': 402, '3159': 403, '3160': 404, '3161': 405, '3162': 406, '3163': 407, '3164': 408, '3165': 409, '3166': 410, '3167': 411, '3168': 412, '3170': 413, '3172': 414, '3211': 415, '3213': 416, '3216': 417, '3221': 418, '3222': 419, '3223': 420, '3225': 421, '3308': 422, '3309': 423, '3310': 424, '3311': 425, '3312': 426, '3313': 427, '3314': 428, '3315': 429, '3316': 430, '3317': 431, '3318': 432, '3319': 433, '3320': 434, '3322': 435, '3324': 436, '3325': 437, '3326': 438, '3329': 439, '3330': 440, '3331': 441, '3332': 442, '3336': 443, '3337': 444, '3339': 445, '3341': 446, '3342': 447, '3343': 448, '3348': 449, '3349': 450, '3350': 451, '3351': 452, '3352': 453, '3353': 454, '3354': 455, '3355': 456, '3356': 457, '3358': 458, '3359': 459, '3360': 460, '3361': 461, '3363': 462, '3364': 463, '3365': 464, '3366': 465, '3367': 466, '3368': 467, '3369': 468, '3370': 469, '3373': 470, '3380': 471, '3381': 472, '3382': 473, '3383': 474, '3384': 475, '3385': 476, '3386': 477, '3387': 478, '3389': 479, '3390': 480, '3402': 481, '3403': 482, '3404': 483, '3408': 484, '3411': 485, '3413': 486, '3414': 487, '3415': 488, '3416': 489, '3421': 490, '3423': 491, '3500': 492, '3501': 493, '3502': 494, '3503': 495, '3504': 496, '3505': 497, '3506': 498, '3507': 499, '3508': 500, '3509': 501, '3510': 502, '3511': 503, '3512': 504, '3513': 505, '3514': 506, '3515': 507, '3516': 508, '3517': 509, '3518': 510, '3519': 511, '3520': 512, '3521': 513, '3522': 514, '3531': 515, '3535': 516, '3542': 517, '3543': 518, '3544': 519, '3545': 520, '3549': 521, '3550': 522, '3551': 523, '3552': 524, '3558': 525, '3559': 526, '3560': 527, '3561': 528, '3562': 529, '3563': 530, '3564': 531, '3565': 532, '3566': 533, '3567': 534, '3568': 535, '3569': 536, '3570': 537, '3572': 538, '3575': 539, '3577': 540, '3580': 541, '3584': 542, '3585': 543, '3586': 544, '3587': 545, '3588': 546, '3589': 547, '3590': 548, '3593': 549, '3595': 550, '3596': 551, '3597': 552, '3598': 553, '3599': 554, '3601': 555, '3602': 556, '3610': 557, '3611': 558, '3612': 559, '4111': 560, '4112': 561, '4113': 562, '4131': 563, '4132': 564, '4141': 565, '4142': 566, '4143': 567, '4144': 568, '4145': 569, '4151': 570, '4152': 571, '4153': 572, '4154': 573, '4156': 574, '4203': 575, '4208': 576, '4210': 577, '4212': 578, '4213': 579, '4214': 580, '4215': 581, '4218': 582, '4219': 583, '4230': 584, '4231': 585, '4232': 586, '4233': 587, '4237': 588, '4239': 589, '4316': 590, '4317': 591, '4323': 592, '4326': 593, '4330': 594, '4331': 595, '4353': 596, '4371': 597, '4379': 598, '4380': 599, '4396': 600, '5121': 601, '5122': 602, '5123': 603, '5124': 604, '5125': 605, '5126': 606, '5129': 607, '5130': 608, '5201': 609, '5202': 610, '5203': 611, '5204': 612, '5206': 613, '5402': 614, '5403': 615, '6111': 616, '6112': 617, '6115': 618, '6117': 619, '6118': 620, '6121': 621, '6122': 622, '6212': 623, '7111': 624, '7112': 625, '7113': 626, '8111': 627, '8112': 628, '8113': 629, '8114': 630, '8115': 631, '8116': 632, '8117': 633, '8118': 634, '8119': 635, '8120': 636, '8121': 637, '8226': 638, '9111': 639, '9112': 640, '9132': 641, '9133': 642, '9191': 643, '9201': 644, '9202': 645, '9203': 646, '9221': 647, '9421': 648, '9422': 649, '9423': 650, '9434': 651, '9435': 652, '9436': 653, '9521': 654, '9715': 655, '9716': 656, '9719': 657, '9721': 658, '9722': 659, '9728': 660, '9731': 661, '9732': 662, '9742': 663, '9744': 664, '9752': 665, '9761': 666, '9762': 667, '9763': 668, '9764': 669, '9766': 670, '9767': 671, '9769': 672, '9772': 673, '9773': 674, '9775': 675, '9777': 676, '9802': 677, '9810': 678, '9813': 679, '9818': 680, '9860': 681, '9863': 682, '9890': 683, '9911': 684, '9912': 685}}

def select_encoded_input(field, label):
    options = list(encoding_maps[field].keys())
    selected = st.selectbox(label, options)
    return encoding_maps[field][selected]

st.title("Simulation d’éligibilité à la C2S")

# Champs encodés
age_ben_snds = select_encoded_input("age_ben_snds", "Âge (classe)")
asu_nat = select_encoded_input("asu_nat", "Régime (asu_nat)")
ben_qlt_cod = select_encoded_input("ben_qlt_cod", "Qualité bénéficiaire")
ben_sex_cod = select_encoded_input("ben_sex_cod", "Sexe")
ben_res_reg = select_encoded_input("ben_res_reg", "Région (code INSEE)")
prs_nat = select_encoded_input("prs_nat", "Type de prestation (code)")

# Champs numériques
flt_rem_mnt = st.number_input("Montant remboursé (€)", min_value=0.0)
flt_act_qte = st.number_input("Nombre d’actes", min_value=0)

# Construction de la requête
payload = {
    "age_ben_snds": age_ben_snds,
    "asu_nat": asu_nat,
    "ben_qlt_cod": ben_qlt_cod,
    "ben_sex_cod": ben_sex_cod,
    "ben_res_reg": ben_res_reg,
    "flt_rem_mnt": flt_rem_mnt,
    "flt_act_qte": flt_act_qte,
    "prs_nat": prs_nat
}

if st.button("Prédire"):
    try:
        response = requests.post("https://fastapi-ol4d.onrender.com/predict", json=payload)
        if response.ok:
            res = response.json()
            st.success(f"Résultat : {'✅ C2S' if res['prediction']==1 else '❌ Non éligible'}")
            st.info(f"Probabilité estimée : {res['probability']*100:.2f} %")
        else:
            st.error("Erreur API.")
    except:
        st.error("Connexion impossible à l'API.")


#streamlit run app_complete.py
